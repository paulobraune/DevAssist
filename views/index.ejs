<div class="row g-4">
  <!-- Main Content Area -->
  <div class="col-lg-8 order-2 order-lg-1">
    <!-- Chat Card -->
    <div class="card shadow-custom h-100">
      <div class="card-header d-flex justify-content-between align-items-center position-relative">
        <div class="d-flex align-items-center">
          <h5 class="card-title mb-0">
            <i class="bi bi-robot text-primary me-2"></i>Chat com DevAssist GPT
          </h5>
        </div>
        <span class="badge bg-primary-subtle rounded-pill" id="connection-badge">
          <span class="spinner-border spinner-border-sm" style="width: 0.7rem; height: 0.7rem;" role="status" aria-hidden="true"></span>
          <span class="ms-1">Conectando...</span>
        </span>
      </div>
      <div class="card-body d-flex flex-column p-0">
        <div id="chatResponses" class="chat-container flex-grow-1">
          <div class="messages-wrapper">
            <div class="message">
              <div class="message-avatar">
                <i class="bi bi-robot"></i>
              </div>
              <div class="message-content">
                <div class="message-text">
                  <p class="mb-1">Olá! Sou o DevAssist GPT, seu assistente de desenvolvimento. Como posso ajudar você hoje?</p>
                  <ul class="mb-0 ps-3">
                    <li>Analisar seu código</li>
                    <li>Responder dúvidas de programação</li>
                    <li>Sugerir melhorias e otimizações</li>
                    <li>Explicar conceitos técnicos</li>
                  </ul>
                </div>
                <div class="message-time">Agora</div>
              </div>
            </div>
          </div>
        </div>
        <form id="chatForm" class="p-3">
          <div class="input-group">
            <textarea id="message" name="message" class="form-control" placeholder="Digite sua pergunta ou problema de programação..." rows="3" required></textarea>
          </div>
          <button type="submit" class="btn btn-primary w-100 mt-2">
            <i class="bi bi-send me-2"></i>Enviar
          </button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Sidebar -->
  <div class="col-lg-4 order-1 order-lg-2">
    <!-- Files Card -->
    <div class="card shadow-custom mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
          <i class="bi bi-folder2-open text-primary me-2"></i>Arquivos
        </h5>
        <div class="d-flex align-items-center">
          <span class="badge bg-primary-subtle rounded-pill me-2">
            <%= files.length %> <%= files.length === 1 ? 'arquivo' : 'arquivos' %>
          </span>
          <span class="badge bg-secondary rounded-pill" id="ssh-status-badge">Verificando...</span>
        </div>
      </div>
      <div class="card-body">
        <% if(files.length === 0) { %>
          <div class="empty-state">
            <i class="bi bi-file-earmark-x empty-state-icon"></i>
            <h6 class="mb-2">Nenhum arquivo encontrado</h6>
            <p class="text-light small mb-0">
              <%= typeof error !== 'undefined' ? error : 'Conectado via SSH: 104.238.145.89' %>
            </p>
          </div>
        <% } else { %>
          <div class="list-group list-group-flush" style="max-height: 250px; overflow-y: auto;">
            <% files.forEach(function(file) { %>
              <div class="file-item rounded-custom-sm">
                <i class="bi bi-file-earmark-code file-icon"></i>
                <div class="file-name">
                  <a href="/file/<%= file %>" class="text-light text-decoration-none">
                    <%= file %>
                  </a>
                </div>
                <div class="file-actions">
                  <a href="/analyze/<%= file %>" class="btn btn-sm btn-primary rounded-pill" data-bs-toggle="tooltip" title="Analisar com GPT">
                    <i class="bi bi-search"></i>
                  </a>
                </div>
              </div>
            <% }); %>
          </div>
        <% } %>
      </div>
      <div class="card-footer bg-dark border-medium p-3">
        <div class="d-flex align-items-center mb-2 text-light">
          <i class="bi bi-hdd-network text-primary me-2"></i>
          <small>Arquivos do servidor remoto via SSH</small>
        </div>
        <form action="/upload" method="post" enctype="multipart/form-data" id="uploadForm">
          <label for="file" class="upload-dropzone mb-2" id="dropzone">
            <div class="text-center">
              <i class="bi bi-cloud-arrow-up text-primary upload-icon"></i>
              <h6 class="fw-bold">Arraste o arquivo ou clique aqui</h6>
              <p class="text-light small mb-0">Upload para servidor remoto</p>
            </div>
            <input class="d-none" type="file" id="file" name="file" required>
          </label>
          <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-upload me-2"></i>Enviar Arquivo
          </button>
        </form>
      </div>
    </div>

    <!-- API Status Card -->
    <div class="card shadow-custom">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="bi bi-lightning-charge text-primary me-2"></i>Status da API
        </h5>
      </div>
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <span>Status:</span>
          <span id="api-status-badge" class="badge bg-secondary">Desconhecido</span>
        </div>
        <div class="d-flex align-items-center justify-content-between mb-2">
          <span>Modelo:</span>
          <div class="d-flex align-items-center">
            <select id="gptModel" class="form-select form-select-sm bg-dark border-medium text-light" style="width: 150px;">
              <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
              <option value="gpt-4">GPT-4</option>
              <option value="gpt-4-turbo">GPT-4 Turbo</option>
              <option value="gpt-4o">GPT-4o</option>
            </select>
          </div>
        </div>
        <button id="testApiBtn" class="btn btn-primary w-100 mt-2">
          <i class="bi bi-arrow-repeat me-2"></i>Testar Conexão
        </button>
        <div id="apiStatus" class="alert mt-3" style="display: none;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Floating action button for mobile -->
<div class="d-lg-none">
  <button class="floating-action-btn d-flex align-items-center justify-content-center" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu">
    <i class="bi bi-list fs-4"></i>
  </button>
</div>

<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border-medium">
      <div class="modal-header border-medium">
        <h5 class="modal-title" id="settingsModalLabel">
          <i class="bi bi-gear-fill text-primary me-2"></i>
          Configurações do DevAssist GPT
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="modelSelect" class="form-label">Modelo do GPT</label>
          <select id="modelSelect" class="form-select bg-medium border-medium text-light">
            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Rápido, Econômico)</option>
            <option value="gpt-4">GPT-4 (Avançado)</option>
            <option value="gpt-4-turbo">GPT-4 Turbo (Avançado, Rápido)</option>
            <option value="gpt-4o">GPT-4o (Mais Recente)</option>
          </select>
          <div class="form-text text-light">Selecione o modelo de IA para utilizar nas consultas</div>
        </div>
        
        <div class="mt-4">
          <label class="form-label">Conexão SSH</label>
          <div class="bg-medium p-3 rounded-custom-sm mb-3">
            <!-- Formulário para edição das configurações SSH -->
            <div class="mb-2">
              <label for="sshHost" class="form-label small mb-1">Host (IP ou Domínio):</label>
              <input type="text" id="sshHost" class="form-control form-control-sm bg-dark border-medium text-light" placeholder="104.238.145.89">
            </div>
            <div class="mb-2">
              <label for="sshPort" class="form-label small mb-1">Porta:</label>
              <input type="number" id="sshPort" class="form-control form-control-sm bg-dark border-medium text-light" placeholder="22" min="1" max="65535">
            </div>
            <div class="mb-2">
              <label for="sshDir" class="form-label small mb-1">Diretório Remoto:</label>
              <input type="text" id="sshDir" class="form-control form-control-sm bg-dark border-medium text-light" placeholder="/home/user/files/">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer border-medium">
        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="saveSettings">
          <i class="bi bi-check-lg me-2"></i>Salvar
        </button>
      </div>
    </div>
  </div>
</div>